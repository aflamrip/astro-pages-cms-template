---
import { getCollection } from 'astro:content';
import PlyrPlayer from '../../../../components/PlyrPlayer.astro';

export async function getStaticPaths() {
  const episodes = await getCollection('episodes');
  return episodes.map(ep => ({
    params: { seriesSlug: ep.data.seriesSlug, slug: ep.slug },
    props: { ep }
  }));
}

const { ep } = Astro.props;
let showPlayer = false;
---

<section class="episode-page max-w-5xl mx-auto p-4">
  <img src={ep.data.poster} alt={ep.data.title} class="rounded-lg shadow-lg mb-4" />
  <h1 class="text-3xl font-bold mb-2">{ep.data.title}</h1>
  <p class="mb-2">{ep.data.description}</p>
  <p class="mb-4 text-sm text-gray-500">Tags: {ep.data.tags.join(', ')}</p>

  <button 
    class="bg-red-600 text-white px-4 py-2 rounded mb-4"
    on:click={() => showPlayer = true}
  >
    المشاهدة الآن
  </button>

  {showPlayer && ep.data.video && (
    <PlyrPlayer src={ep.data.video} />
  )}
</section>
