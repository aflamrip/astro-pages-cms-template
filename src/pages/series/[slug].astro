---
import { getCollection } from 'astro:content';
import PlyrPlayer from '../../components/PlyrPlayer.astro';

export async function getStaticPaths() {
  const series = await getCollection('series');
  return series.map(s => ({
    params: { slug: s.slug },
    props: { series: s }
  }));
}

const { series } = Astro.props;
let showPlayer = false;
---

<section class="series-page max-w-5xl mx-auto p-4">
  <img src={series.data.poster} alt={series.data.title} class="rounded-lg shadow-lg mb-4" />
  <h1 class="text-3xl font-bold mb-2">{series.data.title}</h1>
  <p class="mb-2">{series.data.description}</p>
  <p class="mb-4 text-sm text-gray-500">Tags: {series.data.tags.join(', ')}</p>

  <button 
    class="bg-red-600 text-white px-4 py-2 rounded mb-4"
    on:click={() => showPlayer = true}
  >
    المشاهدة الآن
  </button>

  {showPlayer && series.data.video && (
    <PlyrPlayer src={series.data.video} />
  )}

  <h2 class="text-2xl font-bold mt-8 mb-4">الحلقات</h2>
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    {series.data.episodes?.map(ep => (
      <a href={`/series/${series.slug}/episode/${ep.slug}`} class="hover:scale-105 transition-transform">
        <img src={ep.poster} alt={ep.title} class="rounded-lg shadow-md" />
        <p class="text-center mt-2">{ep.title}</p>
      </a>
    ))}
  </div>

  <h2 class="text-2xl font-bold mt-8 mb-4">مسلسلات مشابهة</h2>
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    {series.data.similar?.map(sim => (
      <a href={`/series/${sim.slug}`} class="hover:scale-105 transition-transform">
        <img src={sim.poster} alt={sim.title} class="rounded-lg shadow-md" />
        <p class="text-center mt-2">{sim.title}</p>
      </a>
    ))}
  </div>
</section>
