---
import { getCollection } from 'astro:content';
import PlyrPlayer from '../../components/PlyrPlayer.astro'; // مشغل الفيديو كـ Astro Island

export async function getStaticPaths() {
  const movies = await getCollection('movies');
  return movies.map(movie => ({
    params: { slug: movie.slug },
    props: { movie }
  }));
}

const { movie } = Astro.props;
let showPlayer = false;
---

<section class="movie-page max-w-5xl mx-auto p-4">
  <img src={movie.data.poster} alt={movie.data.title} class="rounded-lg shadow-lg mb-4" />
  <h1 class="text-3xl font-bold mb-2">{movie.data.title}</h1>
  <p class="mb-2">{movie.data.description}</p>
  <p class="mb-4 text-sm text-gray-500">Tags: {movie.data.tags.join(', ')}</p>

  <button 
    class="bg-red-600 text-white px-4 py-2 rounded mb-4"
    on:click={() => showPlayer = true}
  >
    المشاهدة الآن
  </button>

  {showPlayer && movie.data.video && (
    <PlyrPlayer src={movie.data.video} />
  )}

  <h2 class="text-2xl font-bold mt-8 mb-4">أفلام أخرى</h2>
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
    {movie.data.recommendations?.map(rec => (
      <a href={`/movies/${rec.slug}`} class="hover:scale-105 transition-transform">
        <img src={rec.poster} alt={rec.title} class="rounded-lg shadow-md" />
        <p class="text-center mt-2">{rec.title}</p>
      </a>
    ))}
  </div>
</section>
